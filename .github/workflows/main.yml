name: Veracode_pipeline_scan
on:
  push:
    branches: [ main ]

jobs:
  veracode-sca-task:
    runs-on: ubuntu-latest
    name: pipeline


    steps:
      - name: checkout repo
        uses: actions/checkout@v3

      - name: Build war file
        run: mvn clean package --file app/pom.xml

      - name: List contents of project directory
        run: find . -name "*.war"
      
      # get the compiled binary from a previous job
      - name: get archive
        uses: actions/download-artifact@v3
        with:
          name: ./app/target/verademo 0.0.1-SNAPSHOT.war

      # run the pipeline scan action
      - name: pipeline-scan action step
        id: pipeline-scan
        uses: veracode/Veracode-pipeline-scan-action@v1.0.12
        with:
          vid: ${{ secrets.VID }}
          vkey: ${{ secrets.VKEY }}
          file: "verademo 0.0.1-SNAPSHOT.war"
